import { DividerProps } from '../../common/Divider/Divider';
import { isChallenge, isSideContent } from '@/shared/store/features/stories/criteria';

const svgFilters: Record<string, string[]> = {
  core: [
    "0.06274509803921569 0.1450980392156863 0.22745098039215686 0.33725490196078434 0.4627450980392157 0.5686274509803921 0.6313725490196078 0.6549019607843137 0.6705882352941176 0.7333333333333333",
    "0.0 0.017820416580417022 0.0418600638753557 0.07268211947567652 0.12806155340525224 0.23869295220268422 0.4313088316661949 0.6005796825542034 0.698246474485526 1.0",
    "0.0 0.06117803953746529 0.1424341597519769 0.22685803725799325 0.32200665554222807 0.4385749480013093 0.5743077710848619 0.712424854303936 0.8201229105866816 1.0",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0"
  ],
  dwl: [
    "0.1607843137254902 0.19215686274509805 0.23137254901960785 0.2901960784313726 0.3686274509803922 0.47058823529411764 0.5607843137254902 0.6078431372549019 0.6470588235294118 0.7529411764705882",
    "0.0 0.04124735642586986 0.09993127655155397 0.21296478774035624 0.34514540799448273 0.4699882132732974 0.5931890332015237 0.7283684227088092 0.8381052633423365 1.0",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0",
    "0.0 0.09775450447921179 0.20309568981760925 0.3149981988932581 0.42332454756925403 0.5330394013425639 0.6332317425645179 0.7550573547468503 0.8419962731103058 1.0"
  ],
  ptc: [
    "0.1803921568627451 0.2235294117647059 0.27450980392156865 0.3568627450980392 0.45098039215686275 0.5607843137254902 0.6549019607843137 0.6901960784313725 0.7254901960784313 0.8313725490196079",
    "0.0 0.05459100269989288 0.14435671728233387 0.25508326886977734 0.36179491607753167 0.4564412920952565 0.5592126691372893 0.6906397416141433 0.8405841805495219 1.0",
    "0.0 0.06179788957009381 0.13096060222988795 0.21827835036498283 0.3208500434475831 0.43264858199072603 0.5533745305559578 0.696973930585224 0.8512040051945889 1.0",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0"
  ],
  tfa: [
    "0.10980392156862745 0.17647058823529413 0.24705882352941178 0.32941176470588235 0.41568627450980394 0.5058823529411764 0.5882352941176471 0.6274509803921569 0.6588235294117647 0.7372549019607844",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0",
    "0.0 0.019796662365329447 0.07045684646803606 0.15887956037808304 0.2714495092264563 0.38589998337207976 0.5145637291803709 0.6582217642769267 0.8168321552883047 1.0",
    "0.0 0.0730837555603537 0.14216545582465193 0.21208029053135108 0.3120321051639407 0.42871187328293847 0.5673097718086086 0.703608939854776 0.851815135060154 1.0"
  ],
  tcu: [
    "0.11764705882352941 0.14901960784313725 0.18823529411764706 0.25098039215686274 0.33725490196078434 0.4588235294117647 0.5647058823529412 0.611764705882353 0.6431372549019608 0.7764705882352941",
    "0.0 0.1077249792727011 0.2222222222222222 0.3263107777414187 0.4179204427611206 0.506251613106961 0.6138432621744734 0.7255690061687607 0.8431071575046992 1.0",
    "0.0 0.07045134272096311 0.17825351703529008 0.291126987179887 0.3980450358237877 0.5057965386280843 0.6248512447760305 0.7338090341562595 0.8671238801861018 1.0",
    "0.0 0.1111111111111111 0.21967658106598176 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0"
  ],
  tde: [
    "0.1450980392156863 0.16862745098039217 0.21176470588235294 0.28627450980392155 0.3764705882352941 0.49411764705882355 0.6 0.6470588235294118 0.6784313725490196 0.803921568627451",
    "0.0 0.08141710963508884 0.16497155491854304 0.27561435433719916 0.3783767268983248 0.48189176762315106 0.5836528914475929 0.6978472453000323 0.7968112779864931 0.9764705882352946",
    "0.0 0.09199847907429859 0.1704252044448553 0.2684544283995791 0.3721838466207799 0.477841888669678 0.5806371117128878 0.6867399169491151 0.7738507382227414 0.9529411764705882",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0"
  ],
  tic: [
    "0.1411764705882353 0.17254901960784313 0.22745098039215686 0.30980392156862746 0.4 0.49411764705882355 0.5764705882352941 0.6196078431372549 0.6549019607843137 0.7725490196078432",
    "0.0 0.030971942811681176 0.07482280613113722 0.13698105200492328 0.2264958337555548 0.33743934683507104 0.44492095998767445 0.5367625395462452 0.5814405244178183 0.7730392365794595",
    "0.0 0.09902481297093281 0.19112374909787483 0.28058506004974015 0.38919579321231107 0.5046306363682447 0.6053805781547129 0.7138863186837129 0.8213708817004876 0.992175174857325",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0"
  ],
  eoe: [
    "0.2901960784313726 0.3607843137254902 0.42745098039215684 0.5294117647058824 0.6588235294117647 0.7647058823529411 0.8196078431372549 0.8431372549019608 0.8549019607843137 0.9058823529411765",
    "0.0 0.006565698134870672 0.017210431571520936 0.04793578362014879 0.057451865636785227 0.07346373074797062 0.17034987230649007 0.341081772828604 0.5382197650518091 1.0",
    "0.0 0.08443252065424606 0.1639899804962598 0.24928126981495025 0.33547925038294457 0.42038903617407336 0.5168307292520375 0.6342485984860712 0.7724617163379753 1.0",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0"
  ],
  tsk: [
    "0.12549019607843137 0.17647058823529413 0.25882352941176473 0.4 0.5764705882352941 0.7058823529411765 0.7764705882352941 0.8 0.8235294117647058 0.8784313725490196",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0",
    "0.0 0.01945422600002353 0.03887836457440722 0.061261351543285936 0.08766220852493865 0.11627251330349563 0.15289911500428555 0.22583211282028962 0.342261124478093 1.0",
    "0.0 0.03476636802296287 0.07229491728549564 0.10702749831652772 0.1310134486630149 0.15650771951875075 0.18702857878349116 0.23561066370114261 0.3234319612438208 1.0"
  ],
  fhv: [
    "0.28627450980392155 0.36470588235294116 0.4627450980392157 0.6470588235294118 0.8313725490196079 0.9215686274509803 0.9490196078431372 0.9568627450980393 0.9647058823529412 0.984313725490196",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0",
    "0.0 0.04663263702206335 0.09939945701977014 0.15962941990935176 0.21257716876392724 0.24781190300838407 0.2783419107321408 0.32990733829236935 0.45177535587286854 0.8945848499789507",
    "0.0 0.006558586840196057 0.03162593687264323 0.06728329729860268 0.10143165445907032 0.12263231112290916 0.13801674339931314 0.16419823945026477 0.2498517373778519 0.7092471395500246"
  ],
  tdc: [
    "0.1450980392156863 0.18823529411764706 0.23921568627450981 0.3215686274509804 0.4117647058823529 0.5411764705882353 0.6549019607843137 0.6941176470588235 0.7294117647058823 0.8352941176470589",
    "0.0 0.08975689464499252 0.1776021482077818 0.27676713768853284 0.39528484649103346 0.518607655872374 0.635073611167184 0.744636230241865 0.8778223738656609 0.9980461053576647",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0",
    "0.0 0.06203617854908685 0.11824084031274262 0.202501992020361 0.3076569332288766 0.415864941724603 0.5268934426066108 0.6356143493637568 0.7354955745518733 0.831373860147931"
  ],
  standalone: [
    "0.06274509803921569 0.1450980392156863 0.22745098039215686 0.33725490196078434 0.4627450980392157 0.5686274509803921 0.6313725490196078 0.6549019607843137 0.6705882352941176 0.7333333333333333",
    "0.0 0.015976355037948673 0.04149849526075116 0.07359731836081607 0.1319040085278833 0.24258299976519504 0.43232901291530557 0.5993486971309087 0.6994670375132542 1.0",
    "0.0 0.1111111111111111 0.2222222222222222 0.3333333333333333 0.4444444444444444 0.5555555555555556 0.6666666666666666 0.7777777777777778 0.8888888888888888 1.0",
    "0.0 0.07611826970142888 0.1319144564284855 0.18928570068019518 0.2513892086775167 0.34237980154191716 0.5188931303792796 0.6734934480313614 0.7843307280360309 1.0"
  ],
}

const campaigns: Record<string, number> = {
  core: 218,
  dwl: 114,
  ptc: 267,
  tfa: 330,
  tcu: 316,
  tde: 252,
  tic: 205,
  eoe: 210,
  tsk: 0,
  fhv: 42,
  tdc: 94,

  empty: 37,
  challenge: 23,
  standalone: Infinity, // Серый цвет - hue не определен, hue-rotate не применяется
};

const standalone: Record<string, number> = {
  zbh: 35,
  coh: 59,
  cotr: 157,
  fof: 133,
  guardians: 41,
  mtt: 200,
  hotel: 3,
  blob: 79,
  lol: 253,
  the_midwinter_gala: 24,
  wog: 203,
};

const factions: Record<string, number> = {
  guardian: 214,
  seeker: 37,
  rogue: 110,
  neutral: Infinity,
  mystic: 264,
  survivor: 359,
  multiclass: 49,
};



export const getHeaderFilter = (props: DividerProps) => {
  const svgFilter = getSvgFilter(props);

  if (svgFilter !== undefined) {
    return `url(#header${props.id})`;
  }

  const hueRotation = getHueRotation(props);

  if (hueRotation === Infinity) {
    return 'grayscale(1)';
  }

  return `hue-rotate(${hueRotation}deg)`;
};

export const getSvgFilter = (props: DividerProps) => {
  const { story, id } = props;

  if (story) {
    const code = story.return_to_code || story.code;
    const storyFilter = svgFilters[code];
    const svgFilter = storyFilter === undefined && (isChallenge(story) || isSideContent(story)) ? svgFilters.standalone : storyFilter;

    if (svgFilter !== undefined) {
      const svgId = `header${id}`
      return (
        <svg style={{ display: "block" }}>
          <filter id={svgId}>
            <feComponentTransfer colorInterpolationFilters="sRGB">
              <feFuncR type="table" tableValues={svgFilter[0]}></feFuncR>
            </feComponentTransfer>
            <feColorMatrix colorInterpolationFilters="sRGB" type="matrix" values="1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 1 0"></feColorMatrix>
            <feComponentTransfer colorInterpolationFilters="sRGB">
              <feFuncR type="table" tableValues={svgFilter[1]}></feFuncR>
              <feFuncG type="table" tableValues={svgFilter[2]}></feFuncG>
              <feFuncB type="table" tableValues={svgFilter[3]}></feFuncB>
            </feComponentTransfer>
          </filter>
        </svg>
      );
    }
  }

  return undefined;
}

const getHueRotation = (props: DividerProps): number => {
  const { story, faction } = props;

  if (story) {
    const code = story.return_to_code || story.code;
    const campaignRotation = campaigns[code];

    if (campaignRotation !== undefined) {
      return campaignRotation;
    }

    const standaloneRotation = standalone[code];
    if (standaloneRotation !== undefined) {
      return standaloneRotation;
    }

    if (isChallenge(story)) {
      return campaigns.challenge;
    }

    if (isSideContent(story)) {
      return campaigns.standalone;
    }
  }

  if (faction) {
    return factions[faction] ?? factions.neutral;
  }

  return Infinity;
};
